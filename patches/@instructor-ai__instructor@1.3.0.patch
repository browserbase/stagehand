diff --git a/dist/index.js b/dist/index.js
index e148c810ead2befed73722593b1ee36f28e3398d..e042a93a629d82eafd023e3a28fa996788b072ba 100644
--- a/dist/index.js
+++ b/dist/index.js
@@ -1,3 +1,3 @@
-import{Stream as N}from"openai/streaming.mjs";import{ZodError as w}from"zod";import x,{OAIResponseParser as _,OAIStream as E,withResponseModel as M}from"zod-stream";import{fromZodError as v}from"zod-validation-error";function T(d,e){let o={};for(let n in e)e.hasOwnProperty(n)&&!d.includes(n)&&(o[n]=e[n]);return o}import{MODE as g}from"zod-stream";var t=g,r={OAI:"OAI",ANYSCALE:"ANYSCALE",TOGETHER:"TOGETHER",ANTHROPIC:"ANTHROPIC",GROQ:"GROQ",OTHER:"OTHER"},I={[r.OTHER]:[t.FUNCTIONS,t.TOOLS,t.JSON,t.JSON_SCHEMA,t.MD_JSON],[r.OAI]:[t.FUNCTIONS,t.TOOLS,t.JSON,t.MD_JSON],[r.ANYSCALE]:[t.TOOLS,t.JSON,t.JSON_SCHEMA,t.MD_JSON],[r.TOGETHER]:[t.TOOLS,t.JSON,t.JSON_SCHEMA,t.MD_JSON],[r.ANTHROPIC]:[t.MD_JSON,t.TOOLS],[r.GROQ]:[t.TOOLS,t.FUNCTIONS,t.MD_JSON]},u={[r.ANYSCALE]:"api.endpoints.anyscale",[r.TOGETHER]:"api.together.xyz",[r.OAI]:"api.openai.com",[r.ANTHROPIC]:"api.anthropic.com",[r.GROQ]:"api.groq.com"},S={[r.GROQ]:{[t.TOOLS]:function(e){return e.tools.some(o=>o)&&e.stream&&console.warn("Streaming may not be supported when using tools in Groq, try MD_JSON instead"),e}},[r.ANYSCALE]:{[t.JSON_SCHEMA]:function(e){return"additionalProperties"in e.response_format.schema?{...e,response_format:{...e.response_format,schema:T(["additionalProperties"],e.response_format.schema)}}:e},[t.TOOLS]:function(e){return e.tools.some(o=>o.function?.parameters)?{...e,tools:e.tools.map(o=>o.function?.parameters?{...o,function:{...o.function,parameters:T(["additionalProperties"],o.function.parameters)}}:o)}:e}}},y={[r.OTHER]:{[t.FUNCTIONS]:["*"],[t.TOOLS]:["*"],[t.JSON]:["*"],[t.MD_JSON]:["*"],[t.JSON_SCHEMA]:["*"]},[r.OAI]:{[t.FUNCTIONS]:["*"],[t.TOOLS]:["*"],[t.JSON]:["*"],[t.MD_JSON]:["*"]},[r.TOGETHER]:{[t.MD_JSON]:["*"],[t.JSON_SCHEMA]:["mistralai/Mixtral-8x7B-Instruct-v0.1","mistralai/Mistral-7B-Instruct-v0.1","togethercomputer/CodeLlama-34b-Instruct"],[t.TOOLS]:["mistralai/Mixtral-8x7B-Instruct-v0.1","mistralai/Mistral-7B-Instruct-v0.1","togethercomputer/CodeLlama-34b-Instruct"]},[r.ANYSCALE]:{[t.MD_JSON]:["*"],[t.JSON_SCHEMA]:["mistralai/Mistral-7B-Instruct-v0.1","mistralai/Mixtral-8x7B-Instruct-v0.1"],[t.TOOLS]:["mistralai/Mistral-7B-Instruct-v0.1","mistralai/Mixtral-8x7B-Instruct-v0.1"]},[r.ANTHROPIC]:{[t.MD_JSON]:["*"],[t.TOOLS]:["*"]},[r.GROQ]:{[t.TOOLS]:["mixtral-8x7b-32768","gemma-7b-it"],[t.MD_JSON]:["*"]}};var L=0,R=class{constructor({client:e,mode:o,debug:n=!1,logger:c=void 0,retryAllErrors:s=!1}){this.debug=!1;this.retryAllErrors=!1;this.chat={completions:{create:async(e,o)=>{if(this.validateModelModeSupport(e),this.isChatCompletionCreateParamsWithModel(e))return e.stream?this.chatCompletionStream(e,o):this.chatCompletionStandard(e,o);if(this.client.chat?.completions?.create)return this.isStandardStream(e)?await this.client.chat.completions.create(e,o):await this.client.chat.completions.create(e,o);throw new Error("Completion method is undefined")}}};this.client=e,this.mode=o,this.debug=n,this.retryAllErrors=s,this.logger=c??void 0;let a=typeof this.client?.baseURL=="string"?this.client?.baseURL.includes(u.ANYSCALE)?r.ANYSCALE:this.client?.baseURL.includes(u.TOGETHER)?r.TOGETHER:this.client?.baseURL.includes(u.OAI)?r.OAI:this.client?.baseURL.includes(u.ANTHROPIC)?r.ANTHROPIC:r.OTHER:r.OTHER;this.provider=a,this.validateOptions()}validateOptions(){let e=I[this.provider].includes(this.mode);this.provider===r.OTHER&&this.log("debug","Unknown provider - cant validate options."),e||this.log("warn",`Mode ${this.mode} may not be supported by provider ${this.provider}`)}validateModelModeSupport(e){if(this.provider!==r.OAI){let o=y[this.provider][this.mode];if(!o.includes("*")&&!o.includes(e.model))throw new Error(`Model ${e.model} is not supported by provider ${this.provider} in mode ${this.mode}`)}}log(e,...o){if(this.logger&&this.logger(e,...o),!this.debug&&e==="debug")return;let n=new Date().toISOString();switch(e){case"debug":console.debug(`[Instructor:DEBUG] ${n}:`,...o);break;case"info":console.info(`[Instructor:INFO] ${n}:`,...o);break;case"warn":console.warn(`[Instructor:WARN] ${n}:`,...o);break;case"error":console.error(`[Instructor:ERROR] ${n}:`,...o);break}}async chatCompletionStandard({max_retries:e=L,response_model:o,...n},c){let s=0,a="",C=null,h=S?.[this.provider]?.[this.mode],p=M({params:{...n,stream:n.stream??!1},mode:this.mode,response_model:o});h&&(p=h(p));let f=async()=>{let i=p;a?.length>0&&(i={...p,messages:[...p.messages,...C?[C]:[],{role:"user",content:`Please correct the function call; errors encountered:
+import{Stream as N}from"openai/streaming";import{ZodError as w}from"zod";import x,{OAIResponseParser as _,OAIStream as E,withResponseModel as M}from"zod-stream";import{fromZodError as v}from"zod-validation-error";function T(d,e){let o={};for(let n in e)e.hasOwnProperty(n)&&!d.includes(n)&&(o[n]=e[n]);return o}import{MODE as g}from"zod-stream";var t=g,r={OAI:"OAI",ANYSCALE:"ANYSCALE",TOGETHER:"TOGETHER",ANTHROPIC:"ANTHROPIC",GROQ:"GROQ",OTHER:"OTHER"},I={[r.OTHER]:[t.FUNCTIONS,t.TOOLS,t.JSON,t.JSON_SCHEMA,t.MD_JSON],[r.OAI]:[t.FUNCTIONS,t.TOOLS,t.JSON,t.MD_JSON],[r.ANYSCALE]:[t.TOOLS,t.JSON,t.JSON_SCHEMA,t.MD_JSON],[r.TOGETHER]:[t.TOOLS,t.JSON,t.JSON_SCHEMA,t.MD_JSON],[r.ANTHROPIC]:[t.MD_JSON,t.TOOLS],[r.GROQ]:[t.TOOLS,t.FUNCTIONS,t.MD_JSON]},u={[r.ANYSCALE]:"api.endpoints.anyscale",[r.TOGETHER]:"api.together.xyz",[r.OAI]:"api.openai.com",[r.ANTHROPIC]:"api.anthropic.com",[r.GROQ]:"api.groq.com"},S={[r.GROQ]:{[t.TOOLS]:function(e){return e.tools.some(o=>o)&&e.stream&&console.warn("Streaming may not be supported when using tools in Groq, try MD_JSON instead"),e}},[r.ANYSCALE]:{[t.JSON_SCHEMA]:function(e){return"additionalProperties"in e.response_format.schema?{...e,response_format:{...e.response_format,schema:T(["additionalProperties"],e.response_format.schema)}}:e},[t.TOOLS]:function(e){return e.tools.some(o=>o.function?.parameters)?{...e,tools:e.tools.map(o=>o.function?.parameters?{...o,function:{...o.function,parameters:T(["additionalProperties"],o.function.parameters)}}:o)}:e}}},y={[r.OTHER]:{[t.FUNCTIONS]:["*"],[t.TOOLS]:["*"],[t.JSON]:["*"],[t.MD_JSON]:["*"],[t.JSON_SCHEMA]:["*"]},[r.OAI]:{[t.FUNCTIONS]:["*"],[t.TOOLS]:["*"],[t.JSON]:["*"],[t.MD_JSON]:["*"]},[r.TOGETHER]:{[t.MD_JSON]:["*"],[t.JSON_SCHEMA]:["mistralai/Mixtral-8x7B-Instruct-v0.1","mistralai/Mistral-7B-Instruct-v0.1","togethercomputer/CodeLlama-34b-Instruct"],[t.TOOLS]:["mistralai/Mixtral-8x7B-Instruct-v0.1","mistralai/Mistral-7B-Instruct-v0.1","togethercomputer/CodeLlama-34b-Instruct"]},[r.ANYSCALE]:{[t.MD_JSON]:["*"],[t.JSON_SCHEMA]:["mistralai/Mistral-7B-Instruct-v0.1","mistralai/Mixtral-8x7B-Instruct-v0.1"],[t.TOOLS]:["mistralai/Mistral-7B-Instruct-v0.1","mistralai/Mixtral-8x7B-Instruct-v0.1"]},[r.ANTHROPIC]:{[t.MD_JSON]:["*"],[t.TOOLS]:["*"]},[r.GROQ]:{[t.TOOLS]:["mixtral-8x7b-32768","gemma-7b-it"],[t.MD_JSON]:["*"]}};var L=0,R=class{constructor({client:e,mode:o,debug:n=!1,logger:c=void 0,retryAllErrors:s=!1}){this.debug=!1;this.retryAllErrors=!1;this.chat={completions:{create:async(e,o)=>{if(this.validateModelModeSupport(e),this.isChatCompletionCreateParamsWithModel(e))return e.stream?this.chatCompletionStream(e,o):this.chatCompletionStandard(e,o);if(this.client.chat?.completions?.create)return this.isStandardStream(e)?await this.client.chat.completions.create(e,o):await this.client.chat.completions.create(e,o);throw new Error("Completion method is undefined")}}};this.client=e,this.mode=o,this.debug=n,this.retryAllErrors=s,this.logger=c??void 0;let a=typeof this.client?.baseURL=="string"?this.client?.baseURL.includes(u.ANYSCALE)?r.ANYSCALE:this.client?.baseURL.includes(u.TOGETHER)?r.TOGETHER:this.client?.baseURL.includes(u.OAI)?r.OAI:this.client?.baseURL.includes(u.ANTHROPIC)?r.ANTHROPIC:r.OTHER:r.OTHER;this.provider=a,this.validateOptions()}validateOptions(){let e=I[this.provider].includes(this.mode);this.provider===r.OTHER&&this.log("debug","Unknown provider - cant validate options."),e||this.log("warn",`Mode ${this.mode} may not be supported by provider ${this.provider}`)}validateModelModeSupport(e){if(this.provider!==r.OAI){let o=y[this.provider][this.mode];if(!o.includes("*")&&!o.includes(e.model))throw new Error(`Model ${e.model} is not supported by provider ${this.provider} in mode ${this.mode}`)}}log(e,...o){if(this.logger&&this.logger(e,...o),!this.debug&&e==="debug")return;let n=new Date().toISOString();switch(e){case"debug":console.debug(`[Instructor:DEBUG] ${n}:`,...o);break;case"info":console.info(`[Instructor:INFO] ${n}:`,...o);break;case"warn":console.warn(`[Instructor:WARN] ${n}:`,...o);break;case"error":console.error(`[Instructor:ERROR] ${n}:`,...o);break}}async chatCompletionStandard({max_retries:e=L,response_model:o,...n},c){let s=0,a="",C=null,h=S?.[this.provider]?.[this.mode],p=M({params:{...n,stream:n.stream??!1},mode:this.mode,response_model:o});h&&(p=h(p));let f=async()=>{let i=p;a?.length>0&&(i={...p,messages:[...p.messages,...C?[C]:[],{role:"user",content:`Please correct the function call; errors encountered:
  ${a}`}]});let l;try{if(this.client.chat?.completions?.create)l=await this.client.chat.completions.create({...i,stream:!1},c);else throw new Error("Unsupported client type -- no completion method found.");this.log("debug","raw standard completion response: ",l)}catch(O){throw this.log("error",`Error making completion call - mode: ${this.mode} | Client base URL: ${this.client.baseURL} | with params:`,i,"raw error",O),O}let P=_(l);try{return{...JSON.parse(P),_meta:{usage:l?.usage??void 0}}}catch(O){throw this.log("error","failed to parse completion",P,this.mode,"attempt: ",s,"max attempts: ",e),O}},m=async()=>{try{let i=await f(),l=await o.schema.safeParseAsync(i);if(this.log("debug",o.name,"Completion validation: ",l),!l.success)throw"error"in l?(C={role:"assistant",content:JSON.stringify(i)},a=v(l.error)?.message,l.error):new Error("Validation failed.");return{...l.data,_meta:i?._meta??{}}}catch(i){if(!this.retryAllErrors&&!(i instanceof w))throw i;if(s<e)return this.log("debug",`response model: ${o.name} - Retrying, attempt: `,s),this.log("warn",`response model: ${o.name} - Validation issues: `,a," - Attempt: ",s," - Max attempts: ",e),s++,await m();throw this.log("debug",`response model: ${o.name} - Max attempts reached: ${s}`),this.log("error",`response model: ${o.name} - Validation issues: `,a),i}};return m()}async*chatCompletionStream({max_retries:e,response_model:o,...n},c){e&&this.log("warn","max_retries is not supported for streaming completions");let s=S?.[this.provider]?.[this.mode],a=M({params:{...n,stream:!0},response_model:o,mode:this.mode});s&&(a=s(a));let C=new x({debug:this.debug??!1});async function h(m){for await(let i of m)"usage"in i&&(p=i.usage)}let p,f=await C.create({completionPromise:async()=>{if(this.client.chat?.completions?.create){let m=await this.client.chat.completions.create({...a,stream:!0},c);if(this.log("debug","raw stream completion response: ",m),this.provider==="OAI"&&a?.stream&&"stream_options"in a&&m instanceof N){let[i,l]=m.tee();return h(i),E({res:l})}return E({res:m})}else throw new Error("Unsupported client type")},response_model:o});for await(let m of f)yield{...m,_meta:{usage:p??void 0,...m?._meta??{}}}}isChatCompletionCreateParamsWithModel(e){return"response_model"in e}isStandardStream(e){return"stream"in e&&e.stream===!0}};function A(d){let e=new R(d);return new Proxy(e,{get:(n,c,s)=>c in n?Reflect.get(n,c,s):Reflect.get(n.client,c,s)})}var K=A;export{K as default};
 //# sourceMappingURL=index.js.map
