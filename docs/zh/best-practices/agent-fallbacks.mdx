---
title: 代理回退
description: "当页面出现意外变化而需增加额外步骤时的保险机制"
---

## 何时使用

当原本的单步操作意外演变为多步流程时，将代理回退用作兜底方案。
\---MDX\_CONTENTEND---

## 工作原理

1. 先用 [`act()`](/zh/basics/act) 尝试直接执行操作
2. 如果失败，由 [`agent()`](/zh/basics/agent) 规划新的路径
3. 代理完成所有必要步骤（打开菜单 → 点击按钮）

### 示例场景

**变更前**：Sign In 按钮在页眉\
**变更后**：现在需要：点击账户菜单 → 点击“Sign In”选项

单次 `act("click sign in")` 无法应对这一变化。代理回退可以发现并执行这两个步骤。

<CodeGroup>
  ```typescript TypeScript
  import { Stagehand } from "@browserbasehq/stagehand";

  try {
    await page.act("click the 'Sign In' button");
  } catch (err) {
    console.log("Agent fallback triggered");

    const agent = stagehand.agent({
      provider: "anthropic",
      model: "claude-sonnet-4-20250514",
      instructions: "You are a helpful assistant that can use a web browser.",
    });

    const result = await agent.execute({
      instruction: "Find and click Sign In button",
      maxSteps: 10,
    });

    console.log(result.success ? "Agent fallback success" : "Agent fallback failed");

    if (!result.success) throw err;
  }
  ```

  ```python Python
  from stagehand import Stagehand

  try:
      await page.act("click the 'Sign In' button")
  except Exception as err:
      print("Agent fallback triggered")

      agent = stagehand.agent({
          "provider": "anthropic",
          "model": "claude-sonnet-4-20250514",
          "instructions": "Complete the action, handling any new steps required.",
      })

      result = await agent.execute({
          "instruction": "Find and click Sign In button",
          "max_steps": 10,
      })

      print("Agent fallback success" if result.success else "Agent fallback failed")

      if not result.success:
          raise err
  ```
</CodeGroup>
