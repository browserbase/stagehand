---
title: "使用 CrewAI 自动化浏览器任务"
sidebarTitle: 配置
description: "使用自然语言指令创建可与网站交互并自动化浏览器任务的智能代理"
---

本指南将带您完成将 CrewAI 与 Browserbase 配置集成的流程，以创建能够通过自然语言指令执行网页自动化任务的代理。

## 步骤 1：安装依赖

为 CrewAI 与 Stagehand 集成安装所需的包：

```bash
pip install stagehand-py crewai crewai-tools
```

## 步骤 2：配置环境变量

你需要从以下服务获取 API 密钥：

1. **Browserbase API Key 和 Project ID**：在你的 [Browserbase 仪表板](https://www.browserbase.com/) 中获取
2. **LLM API Key**：从 [OpenAI](https://platform.openai.com/api-keys) 或 [Anthropic](https://console.anthropic.com/) 获取

将这些 API 密钥安全地存储为环境变量：

```bash
BROWSERBASE_API_KEY="your-browserbase-api-key"
BROWSERBASE_PROJECT_ID="your-browserbase-project-id"
OPENAI_API_KEY="your-openai-api-key"
ANTHROPIC_API_KEY="your-anthropic-api-key"
```

## 步骤 3：创建你的第一个代理

编写一个包含基础 CrewAI 代理的 Python 脚本：

```python
import os
from crewai import Agent, Task, Crew
from crewai_tools import StagehandTool
from stagehand.schemas import AvailableModel

# 从环境变量获取 API 密钥
browserbase_api_key = os.environ.get("BROWSERBASE_API_KEY")
browserbase_project_id = os.environ.get("BROWSERBASE_PROJECT_ID")
model_api_key = os.environ.get("OPENAI_API_KEY")  # 或 ANTHROPIC_API_KEY

# 初始化 StagehandTool
stagehand_tool = StagehandTool(
    api_key=browserbase_api_key,
    project_id=browserbase_project_id,
    model_api_key=model_api_key,
    model_name=AvailableModel.GPT_4O,  # 或 AvailableModel.CLAUDE_3_7_SONNET_LATEST
)

# 使用该工具创建一个代理
researcher = Agent(
    role="Web Researcher",
    goal="Find and summarize information from websites",
    backstory="I'm an expert at finding information online.",
    verbose=True,
    tools=[stagehand_tool],
)
```

## 步骤 4：创建并运行任务

为代理定义一个任务并执行：

```python
# 创建一个使用该工具的任务
research_task = Task(
    description="访问 https://www.example.com，并告诉我主页上有哪些内容。",
    agent=researcher,
)

# 运行 crew
crew = Crew(
    agents=[researcher],
    tasks=[research_task],
    verbose=True,
)

try:
    result = crew.kickoff()
    print(result)
finally:
    # 释放资源
    stagehand_tool.close()
```

## 步骤 5：运行脚本

执行 Python 脚本：

```bash
python your_crew_script.py
```

## 高级配置

通过附加参数自定义 StagehandTool 的行为：

```python
stagehand_tool = StagehandTool(
    api_key=browserbase_api_key,
    project_id=browserbase_project_id, 
    model_api_key=model_api_key,
    model_name=AvailableModel.CLAUDE_3_7_SONNET_LATEST,
    dom_settle_timeout_ms=5000,  # 更长时间等待 DOM 稳定
    headless=True,  # 以无头模式运行浏览器
    self_heal=True,  # 尝试从错误中恢复
    wait_for_captcha_solves=True,  # 等待 CAPTCHA 解题完成
    verbose=1,  # 控制日志详细程度（0-3）
)
```

## 示例任务

<Tabs>
  <Tab title="表单提交" value="form-submission" label="Python">
    ```python
    form_task = Task(
        description="""
        提交联系表单：
        1. 访问 https://example.com/contact
        2. 使用姓名“John Doe”、邮箱“john@example.com”填写表单
        3. 提交并确认成功
        """,
        agent=researcher,
    )
    ```
  </Tab>
  <Tab title="数据提取" value="data-extraction" label="Python">
    ```python
    extraction_task = Task(
        description="""
        提取产品信息：
        1. 进入产品页面
        2. 提取所有产品的名称、价格和描述
        3. 格式化为结构化数据
        """,
        agent=researcher,
    )
    ```
  </Tab>
  <Tab title="多步导航" value="multi-step-navigation" label="Python">
    ```python
    navigation_task = Task(
        description="""
        导航并分析：
        1. 从首页开始
        2. 前往产品板块  
        3. 按“Electronics”类别筛选
        4. 查找并提取评分最高的产品详情
        """,
        agent=researcher,
    )
    ```
  </Tab>
</Tabs>

<CardGroup cols={2}>
  <Card title="CrewAI 文档" icon="book" href="https://docs.crewai.com/">
    查看 CrewAI 文档，了解其功能与集成。
  </Card>
  <Card title="Browserbase 文档" icon="book" href="https://docs.browserbase.com/">
    查阅 Browserbase 文档，获取完整指南与资源。
  </Card>
</CardGroup>