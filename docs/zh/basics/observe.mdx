---
title: 观察
sidebarTitle: 观察
description: "为你的工作流寻找建议操作"
---

## 什么是 `observe()`？

```typescript
page.observe("Find the login button")
```

`observe()` 让你把任意页面变成一份可靠、可执行的操作清单。它会发现关键元素、为可能的后续步骤排序，并返回结构化操作（selector、method、arguments），可直接配合 `act()` 立即执行，或用于精确指向 `extract()`，从而让工作流更快、更省成本、更稳健。

## 为什么使用 `observe()`？

<CardGroup cols={2}>
  <Card title="Explore" icon="compass" href="/zh/basics/observe#observe-with-act">
    当你不确定页面内容或需要发现可执行的操作时
  </Card>

  <Card title="Plan" icon="map" href="/zh/basics/observe#plan-ahead">
    构建复杂工作流时，预先规划所有需要执行的操作
  </Card>

  <Card title="Cache" icon="database" href="/zh/best-practices/caching">
    想要缓存操作以便日后复用，并避免发起 LLM 调用时
  </Card>

  <Card title="Validate" icon="check" href="/zh/basics/observe#observe-with-act">
    在执行关键操作前，先验证目标元素是否存在
  </Card>
</CardGroup>

## 使用 `observe()`

调用 `observe` 能为其他 Stagehand 方法提速增效。用它来规划工作流、加速 `act()`，并精准定位 `extract()`。使用 `observe` 还能通过提供建议操作列表来帮助你探索页面上可执行的内容。

<CodeGroup>
  ```typescript TypeScript
  // Plan & validate
  const buttons = await page.observe("Find the log in / sign up buttons");
  ```

  ```python Python
  # Plan & validate
  buttons = await page.observe("Find the log in / sign up buttons")
  ```
</CodeGroup>

这将返回一个建议列表，结构如下：

```json
{
  "selector": "xpath=/html/body/header/div/button[1]",
  "description": "Log in button in the top right corner",
  "method": "click",
  "arguments": []
}
```

### 搭配 Act 使用

你可以先“验证”该操作（method、selector、arguments 等），再将其传给 `act()`，以避免额外的 LLM 推理。

<Note>
  **性能提示**：对多个 `observe` 建议直接执行操作，可将多步流程的 LLM 调用次数降至最低，使工作流提速 2–3 倍。
</Note>

<CodeGroup>
  ```typescript TypeScript
  await page.act(buttons[0]); // No LLM!
  ```

  ```python Python
  await page.act(buttons[0]) # No LLM!
  ```
</CodeGroup>

#### 提前规划

你可以利用 `observe` 返回的多条建议来预览并批量执行操作。例如，填写表单时，可让 `observe` 找到所有字段，再逐条传给 `act()`。只调用一次 LLM，多次执行 act。

<CodeGroup>
  ```typescript TypeScript
  const fields = await page.observe("Find all the fields in the form");
  for (const field of fields) {
    await page.act(field); // No LLM!
  }
  ```

  ```python Python
  fields = await page.observe("Find all the fields in the form")
  for field in fields:
    await page.act(field) # No LLM!
  ```
</CodeGroup>

### 观察并提取

使用 `observe` 将 `extract()` 聚焦到页面的特定区域（如表格、表单、列表等），可显著缩小提取所需的上下文范围。

<Tip>
  **节省成本提示**：将 selector 传给 `extract()`，对于内容冗长的网站可将 LLM token 使用量降低 10 倍！
</Tip>

<CodeGroup>
  ```typescript TypeScript
  // Use observe to validate elements before extraction
  const [ table ] = await page.observe("Find the data table");

  const { data } = await page.extract({
    instruction: "Extract data from the table",
    schema: z.object({
      data: z.string()
    }),
    selector: table.selector // Reduce context scope needed for extraction
  });
  ```

  ```python Python
  # Use observe to validate elements before extraction
  [ table ] = await page.observe("Find the data table")

  extraction = await page.extract(
    "Extract data from the table",
    schema=Data, # Pydantic schema
    selector=table.selector # Reduce context scope needed for extraction
  )
  ```
</CodeGroup>

## 最佳实践

### 选择合适的命令

<Tabs>
  <Tab title="推荐做法">
    - 当是/否答案会决定是否执行某个动作时，使用 `observe`（例如，“找到 Submit 按钮”），然后再有条件地调用 `act`。
    - 对纯信息类问题使用 `extract`（例如，“页面标题是什么？”、“列出了多少个结果？”）。
  </Tab>

  <Tab title="避免做法">
    - 不要用 `extract` 去定位你接下来要点击的元素。
    - 不要用 `observe` 去回答不会引发后续动作的纯信息问题。
  </Tab>
</Tabs>

- 使用 `observe` 进行发现与规划：调用 `observe("Find…")` 映射可执行元素并预览下一步。
- 用来自 `observe` 的选择器来限定 `extract` 的范围：先 `observe("Find the data table")`，再将返回的 `selector` 传给 `extract`，以减少 token 并提升准确性。

### 节省 LLM token

通过将 `ObserveResult` 直接传给 `act`（例如，`await page.act(results[0])`）来优化性能并节省 LLM token。先用一次 `observe` 找到元素，再依次执行各个操作。对熟悉的页面缓存并复用稳定的 `observe` 结果，布局变更时启用 Self‑healing。

<Card title="构建你的动作缓存" icon="database" href="/zh/best-practices/caching">
  查看如何构建你自己的动作缓存的指南
</Card>

### 提升准确性

指令要精确，例如：“在 hero 区找到主要 CTA”，可获得更好结果。对于 iframes，设置 `iframes: true` 并等待 `networkidle`。在 `extract` 中使用 `observe` 返回的选择器以收窄上下文。

<Card title="提示工程最佳实践" icon="robot" href="/zh/best-practices/prompting-best-practices">
  查看如何提升结果准确性的指南
</Card>

### 动作校验

在执行关键动作前，校验建议的 `method`、`selector` 和 `arguments`，以避免误点。若直接 `act` 失败，则用相同的提示配合 `observe` 验证方法，再按建议的动作执行。

<CodeGroup>
  ```typescript TypeScript
  const prompt = "click the submit button";
  const expectedMethod = "click";

  try {
    await page.act(prompt);
  } catch (error) {
    if (error.message.includes("method not supported")) {
      // Observe the same prompt to get the planned action
      const [action] = await page.observe(prompt);
      
      if (action && action.method === expectedMethod) {
        await page.act(action);
      } else {
        throw new Error(`Unsupported method: expected "${expectedMethod}", got "${action?.method}"`);
      }
    } else {
      throw error;
    }
  }
  ```

  ```python Python
  prompt = "click the submit button"
  expected_method = "click"

  try:
      await page.act(prompt)
  except Exception as error:
      if "method not supported" in str(error):
          # Observe the same prompt to get the planned action
          results = await page.observe(prompt)
          
          if results and results[0].method == expected_method:
              await page.act(results[0])
          else:
              method = results[0].method if results else "unknown"
              raise Exception(f'Unsupported method: expected "{expected_method}", got "{method}"')
      else:
          raise error
  ```
</CodeGroup>

## 故障排查

<AccordionGroup>
  <Accordion title="未找到元素">
    **问题**：`observe` 返回空数组

    **解决方案**：

    - 确认页面上确实存在该元素
    - 用更明确的指令定位该元素
    - 确保页面已完全加载
    - 查看[调试工作流](/zh/best-practices/debugging-workflows)日志；如果日志中能看到该元素，可能是 LLM 产生幻觉或未正确识别
  </Accordion>

  <Accordion title="元素描述不准确">
    **问题**：描述与实际元素不匹配

    **解决方案**：

    - 使用更强的模型：参考 [evals](https://stagehand.dev/evals) 选择适合你用例的最佳模型
    - 提供更具体的指令
    - 将推理过程写入文件（见[调试工作流](/zh/best-practices/debugging-workflows)）以获取 LLM trace
  </Accordion>

  <Accordion title="识别了错误的方法">
    **问题**：识别的方法无效

    **解决方案**：

    - 查看[支持的操作](/zh/basics/act)
    - 提供更具体的指令
    - 校验该方法；若无效，改用受支持的方法
  </Accordion>
</AccordionGroup>

## 后续步骤

<CardGroup cols={2}>
  <Card title="Act Overview" icon="play" href="/zh/basics/act">
    使用 observe() 结果高效执行动作
  </Card>

  <Card title="Extract Data" icon="download" href="/zh/basics/extract">
    从已观察的元素提取结构化数据
  </Card>

  <Card title="Observability" icon="chart-line" href="/zh/configuration/observability">
    监控与调试观测性能
  </Card>

  <Card title="Best Practices" icon="star" href="/zh/best-practices/best-practices">
    高级模式与优化技巧
  </Card>
</CardGroup>
