---
title: Advanced Configuration
sidebarTitle: Advanced
description: Configure Stagehand for optimal performance and reliability
---

Advanced configuration options for optimizing performance, enabling resilience, and accessing experimental features in Stagehand.

## Experimental Features

Enable experimental features that are under active development.

```typescript
const stagehand = new Stagehand({
  env: "BROWSERBASE",
  experimental: true // Enable experimental features
});
```

<Warning>
**Use with caution in production**. Experimental features:
- May change or be removed in future versions without notice
- Have not undergone full stability testing
- May have incomplete documentation
- Are not covered by standard support SLAs
</Warning>


## Disable Stagehand API

Disable internal API endpoints (advanced use case) when running on Browserbase. 

```typescript
const stagehand = new Stagehand({
  env: "BROWSERBASE",
  disableAPI: true // Disable internal API endpoints
});
```
<Note>
Most users should **not** set this flag. This will limit observability and metrics on session replay and debugging.
</Note>

## Best Practices

<AccordionGroup>

<Accordion title="Start with Defaults">
Begin with default settings and only adjust when needed:

```typescript
// Start here
const stagehand = new Stagehand({
  env: "BROWSERBASE"
});

// Add advanced config based on observed behavior
const optimizedStagehand = new Stagehand({
  env: "BROWSERBASE",
  cacheDir: "./cache", // Add after testing
  selfHeal: true // Add if seeing layout issues
});
```
</Accordion>

<Accordion title="Measure Impact">
Always measure the impact of advanced configurations:

```typescript
const startTime = Date.now();

const stagehand = new Stagehand({
  env: "BROWSERBASE",
  cacheDir: "./cache",
  selfHeal: true
});

// ... run automation

const metrics = await stagehand.metrics;
const duration = Date.now() - startTime;

console.log(`Duration: ${duration}ms`);
console.log(`Tokens: ${metrics.totalPromptTokens + metrics.totalCompletionTokens}`);
```
</Accordion>

<Accordion title="Environment-Specific Configs">
Use different configurations for different environments:

```typescript
const config = {
  env: "BROWSERBASE",
  cacheDir: process.env.NODE_ENV === 'production'
    ? "./production-cache"
    : "./dev-cache",
  selfHeal: process.env.NODE_ENV === 'production', // Only in prod
  experimental: process.env.NODE_ENV !== 'production' // Only in dev
};

const stagehand = new Stagehand(config);
```
</Accordion>

<Accordion title="Monitor Cache Performance">
Track cache hit rates and adjust strategies:

```typescript
import { existsSync, statSync } from 'fs';

const cacheDir = "./cache";
const cacheExists = existsSync(cacheDir);

console.log(cacheExists ? "Cache hit" : "Cache miss");

const stagehand = new Stagehand({
  env: "BROWSERBASE",
  cacheDir
});

// Log cache statistics
if (cacheExists) {
  const stats = statSync(cacheDir);
  console.log(`Cache age: ${Date.now() - stats.mtimeMs}ms`);
}
```
</Accordion>

</AccordionGroup>

## Troubleshooting

<AccordionGroup>

<Accordion title="Cache not working">
**Problem**: Actions still slow despite caching

**Solutions**:
- Verify `cacheDir` path exists and has write permissions
- Check that instructions are exactly identical across runs
- Look for cache hit/miss logs with `verbose: 2`
- Ensure cache files aren't being deleted between runs

```typescript
const stagehand = new Stagehand({
  env: "BROWSERBASE",
  cacheDir: "./cache",
  verbose: 2 // Debug logging
});
```
</Accordion>

<Accordion title="Self-healing too slow">
**Problem**: Self-healing adds too much overhead

**Solutions**:
- Reduce retries by using more specific instructions
- Combine with caching to avoid repeated self-heal attempts
- Consider disabling self-heal and using explicit error handling instead

```typescript
const stagehand = new Stagehand({
  env: "BROWSERBASE",
  selfHeal: false // Disable if performance is critical
});
```
</Accordion>

<Accordion title="DOM settle timeout issues">
**Problem**: Actions failing or taking too long

**Solutions**:
- Increase timeout for dynamic pages
- Decrease timeout for static pages
- Use page-specific waits instead of global timeout

```typescript
// Increase for dynamic pages
const stagehand = new Stagehand({
  env: "BROWSERBASE",
  domSettleTimeout: 5000
});

// Or use explicit waits
await page.waitForLoadState('networkidle');
await page.act("click button");
```
</Accordion>

<Accordion title="Experimental features unstable">
**Problem**: Unexpected behavior with experimental features

**Solutions**:
- Disable experimental features in production
- Report issues to Stagehand team with verbose logs
- Use stable features for critical workflows

```typescript
const stagehand = new Stagehand({
  env: "BROWSERBASE",
  experimental: false, // Disable for stability
  verbose: 2 // Enable for debugging
});
```
</Accordion>

</AccordionGroup>

## Next Steps

<CardGroup cols={2}>
  <Card title="Caching Guide" icon="database" href="/best-practices/caching">
    Deep dive into caching strategies and patterns
  </Card>

  <Card title="Deterministic Agent" icon="robot" href="/best-practices/deterministic-agent">
    Use caching to create fast, deterministic agent workflows
  </Card>

  <Card title="Browser Configuration" icon="browser" href="/configuration/browser">
    Configure browser environments and launch options
  </Card>

  <Card title="Observability" icon="chart-line" href="/configuration/observability">
    Monitor metrics and track performance
  </Card>
</CardGroup>
